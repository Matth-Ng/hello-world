name: Staging Build and Push Container

on:
  workflow_dispatch:

env:
  AWS_ECR_REPO: 008577686731.dkr.ecr.us-gov-west-1.amazonaws.com/dsva/platform-console-ui

jobs:
  update-staging-manifest:
    runs-on: ubuntu-latest
    environment: 'staging'
    outputs:
      sha-result: ${{ steps.sha-result.outputs.staging-sha }}
    steps:
      - name: Checkout by staging-deployment-release-tag
        id: checkoutTag
        uses: actions/checkout@v2
        continue-on-error: false
        with:
          ref: 'staging-deployment-release-tag'
      - name: do something
        if: steps.checkoutTag.outcome == 'success'
        id: actualWorkStepSuccess
        run: echo "Success____________________________________________________"
      - name: Check Current sha
        run: |
          echo "staging ref: ${{ github.event.client_payload.staging-ref }}"
      - name: Dispatch Utility Ref
        uses: peter-evans/repository-dispatch@v1.0.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          event-type: builds
          client-payload: '{"utility-ref": "${{ github.event.client_payload.staging-ref }}"}'