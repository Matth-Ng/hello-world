name: Staging Build and Push Container

on:
  workflow_dispatch:

env:
  AWS_ECR_REPO: 008577686731.dkr.ecr.us-gov-west-1.amazonaws.com/dsva/platform-console-ui

jobs:
  update-staging-manifest:
    runs-on: ubuntu-latest
    environment: 'staging'
    steps:
      - name: Checkout by staging-deployment-release-tag
        id: checkoutTag
        uses: actions/checkout@v2
        continue-on-error: false
        with:
          ref: 'staging-deployment-release-tag'
      - name: do something
        if: steps.checkoutTag.outcome == 'success'
        id: actualWorkStepSuccess
        run: echo "Success____________________________________________________"
      # - name: Rename staging tag to utility tag
      #   uses: localazy/tag@v1
      #   with:
      #     read_key: ${{ secrets.GITHUB_TOKEN }}
      #     write_key: ${{ secrets.GITHUB_TOKEN }}
      #     rename_from: 'staging-deployment-release-tag'
      #     rename_to: 'utility-deployment-release-tag'
      # - name: Create tag
      #   uses: actions/github-script@v5
      #   with:
      #     script: |
      #       github.rest.git.createRef({
      #         owner: context.repo.owner,
      #         repo: context.repo.repo,
      #         ref: 'refs/tags/<tagname>',
      #         sha: context.sha
      #       })
      - name: Run latest-tag
        uses: EndBug/latest-tag@latest
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          Default: 'staging-deployment-release-tag'
          ref: 'refs/tags/utility-deployment-release-tag'
          # script: |
          #   github.rest.git.createRef({
          #     owner: context.repo.owner,
          #     repo: context.repo.repo,
          #     ref: 'refs/tags/staging-deployment-release-tag',
          #     sha: context.sha
          #   })
      # - uses: cardinalby/git-tag-action@master
      #   env:
      #     TAG: 'utility-deployment-release-tag'
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      # - name: Delete delayed-job-tag  
      #   if: steps.actualWorkStepSuccess.outcome == 'success'
      #   uses: dev-drprasad/delete-tag-and-release@v0.2.0
      #   with:
      #     tag_name: 'staging-deployment-release-tag'
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}